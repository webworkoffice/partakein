#summary 公開WebAPIの仕様について議論してまとめるページ

under construction.
テスト運用中。書いてあるURLやJS、レスポンスなどは架空のものです。

<wiki:toc max_depth="2" />

以下のおける URL は、/ 以下を指定していますが、公式サイトの API にアクセスする場合は、http://partake.in/ を付加してください。

= Account =

ユーザー自身に関する API

== セッショントークンの取得 ==

`/api/account/getSessionToken`

{{{
TBW
}}}

== 自分自身の情報の取得 ==

`/api/account/get`

{{{
TBW
}}}

== 自分自身の参加・管理するイベントを取得 ==

`/api/account/getEvents`

MyPage で取得可能なイベントが見られる。
get と統合するべきか？

{{{
TBW
}}}


== ユーザーの設定の取得 ==

`/api/account/getPreference`

get と統合するべきか？　分けておいたほうがよいか？

{{{
TBW
}}}

== ユーザーの設定の変更 ==

`/api/account/setPreference`

{{{
TBW
}}}

== OpenID 結びつけ状態の取得 ==

`/api/account/getOpenID`

get と統合するべきか？　分けておいたほうがよいか？

{{{
TBW
}}}

== OpenID 結びつけ状態を解除 ==

`/api/account/removeOpenID`

{{{
TBW
}}}

== カレンダー URL の取得 ==

`/api/account/getCalendar`

TBW

= User =

== ユーザーの取得 ==

`/api/user/get`

TBW

== ユーザーが参加しているイベント情報の習得 ==

`/api/user/getEvents`

ユーザーページと同じ情報を得ることができる。MyPage で見られる情報とは異なる。

TBW

= Event =

== イベントの取得 == 

`/api/event/get`

TBW

== イベントの登録 == 

`/api/event/create`

TBW

== イベントの変更 == 

`/api/event/modify`

TBW

== イベントの検索 ==

`/api/event/search`

=== parameters ===
||*name*||*default value*||*explanation*||
||query||(Empty String)||検索キーワード||
||category||all||検索対象のカテゴリ（複数指定不可）（[PublicWebAPI#Category]を参照）||
||beforeDeadlineOnly||true||trueの場合、締切りを過ぎたイベントを検索結果に含めない||
||sortOrder||score||検索結果のソート順（[PublicWebAPI#SortOrder]を参照）||
||maxNum||10||取得するイベントの最大数||


== イベントへの参加、仮参加、キャンセル ==

`/api/event/enroll`

TBW

== イベント参加者の取得 == 

`/api/event/participants`

TBW

== イベントのコメントの取得 == 

`/api/event/comments`

TBW

== 参加者へのメッセージの送信 == 

`/api/event/sendMessage`

TBW

== 参加者へのメッセージの取得 == 

`/api/event/getMessage`

TBW

== 出欠 ==

`/api/event/attendance`

イベントへの出席、欠席を管理する用の API です。

TBW

= デバグ用 API =

デバグ用 API は、PARTAKE が正常終了、エラー終了をどのように返すかのサンプルとして活用することができます。また、しばしばユニットテストにも利用されます。

== 常に 200 OK を返す ==

`/api/debug/success`

{{{
TBW
}}}

== 常に 400 Bad Request を返す ==

`/api/debug/invalid`

{{{
TBW
}}}

== 常に 404 Not found を返す ==

TBW 

= Note =
== Category ==
PARTAKEが扱うイベントのカテゴリは以下のとおり。APIの引数にカテゴリを指定する場合は、大文字小文字が区別されることに注意。
||*name*||*explanation*||
||all||カテゴリ制限なし||
||meeting||懇親会・オフ会||
||computer||コンピューター||
||sports||スポーツ||
||game||ゲーム||
||watching||鑑賞(芸術、映画)||
||neta||ネタ||
||others||その他||

== SortOrder ==
PARTAKEの検索APIに指定できるソート順は以下のとおり。APIの引数にカテゴリを指定する場合は、大文字小文字が区別されることに注意。
||*name*||*explanation*||
||score||マッチ度順||
||createdAt||新着順||
||deadline||締切の早い順||
||deadline-r||締切の遅い順||
||beginDate||開始日時の早い順||
||beginDate-r||開始日時の遅い順||
        
= Sample =

基本的に API のパラメータは URL の query 部分で表現される。
変更する系のメソッドは POST リクエストを、取得する系メソッドは GET リクエストを受け付ける。

返却値は全て json 形式であり、クエリーに成功すれば HTTP のステータスコードとして 200 が使われる。
失敗すれば 200 以外のエラーコードが用いられる。理由も json 形式で返される。
返却される json には、必ず result という key が含まれる。失敗すれば、reason という key で取得できる値でエラー理由が説明される。

主なエラーコードは次の通り。
  * 400 ユーザーからのリクエストに誤りがあった。必要なパラメータが欠けている。
  * 401 ログインが必要な API にログインなしでアクセスしようとした。
  * 403 クエリーの実行に権限がない。他人が管理しているイベントを変更するなどが該当する。
  * 500 サーバー内部でエラーが発生した。なんどか繰り返しても同じエラーが発生するようであればサーバーに障害が起こっているか、バグである。

== URL ==
`http://partake.in/api/event/get?event_id=<id>`

== Response sample ==
{{{
{ result: "ok",
  event : {
    "id": "test_id",
    "title": "sample event",
    "summary": "a sample event to explain partake api",
    "category": "neta",
    "deadline": "2011/05/20 18:00:00",
    "beginDate": "2011/05/20 20:00:00",
    "endDate": "2011/05/20 22:00:00",
    "capacity": 20,
    "url": "http://partake.in/",
    "place": "here",
    "address": "somewhere",
    "description": "<p>hogehoge</p>",
    "hashTag": "#partakein",
    "ownerId": "1234567890",
    "managerIdList": ["1234567890a", "1234567890b"],
    "isPrivate": false,
    "createdAt": "2011/05/19 12:00:00",
    "modifiedAt": "2011/05/19 15:00:00"
  }
}
}}}


if your request is rejected, partake-server response 400(Bad Request).
if specified event doesn't exist, partake-server response 404(Not Found).

== How to access through partake.js ==
{{{
var event = $.partake().event('<event_id>').get();
if (!!event) {
  $('#title').text(event.title);
}
}}}

= TODO =
 * fix the format for managerId
 * allow to specify response format (ex. json, jsonp, rss, xml)